# 拉格朗日建模法

[参考文章](https://zhuanlan.zhihu.com/p/156760739)

| 物理量     | 物理符号   | 物理量           | 物理符号     |
| ---------- | ---------- | ---------------- | ------------ |
| 广义坐标   | $q$        | 动能             | $T(\dot{q})$ |
| 广义速度   | $\dot{q}$  | 势能             | $V(q)$       |
| 广义加速度 | $\ddot{q}$ | 外力（关节力矩） | $\tau$       |
| 时间       | t          | 拉格朗日量       | $L$          |

> 从拉格朗日动力学方程可以得到以下公式

$$
\frac{\partial (\frac{\partial L}{\partial (\dot{q})})}{\partial t} - \frac{\partial L}{\partial q}=\tau \\
L=T(\dot{q})-V(q)
$$

现在，让我们从我们熟悉的三维空间出发，假定这个空间中的物体可以看成由n个质点组成，很显然这个系统应该由3n个自由度，故这个物理的位置可以用广义坐标表示出来
$$
q = \left[\matrix{x_0 & y_0 & z_0 & x_1 & y_1 & z_1 &.....& x_{n-1} & y_{n-1} & z_{n-1} }\right]^T
$$
所以我们就可以得出这个系统的广义速度
$$
\dot{q} = \left[\matrix{\dot{x_0} & \dot{y_0} & \dot{z_0} & \dot{x_1} & \dot{y_1} & \dot{z_1} &.....& \dot{x_{n-1}} & \dot{y_{n-1}} & \dot{z_{n-1}} }\right]^T
$$
我们首先来看系统的动能$T$，它实际上是等于整个系统中每一个质点的动能之和，即：
$$
T=\dot{q}^T\sum_{i=0}^{n-1}\frac{1}{2}m_i{v_i}^2=\frac{1}{2}\dot{q}^TM\dot{q}=T(\dot{q})
$$
其中矩阵$M=diag(m_0,m_0,m_0,...,m_{n-1},m_{n-1},m_{n-1})$。明显地，动能$T$是只关于广义速度  $\dot{q}$  的函数。

接下来，让我们来着手分析系统的势能$V$，它的组成会比动能复杂一些，分析势能时，我们往往需要确定系统的零势能点，如重力势能，弹性势能等。
$$
重力势能：我们不妨选取广义坐标原点为零势能点，n表示质点的个数 \\
V=\sum_{i=0}^{n-1}m_igh_i=\sum_{i=0}^{n-1}m_ig\sqrt{(x_i^2+y_i^2+z_i^2)}=V(q) \\
弹性势能：可以回想一下高中的知识，n表示所有弹簧的数量 \\
V=\frac{1}{2}kx^2=\frac{1}{2}\sum_{i=0}^{n-1} k\sqrt{(x_{i}-x_{i-1})^2+(y_{i}-y_{i-1})^2+(z_i-z_{i-1})^2}=V(q)
$$
很显然，系统的势能$V$是只关于广义坐标的函数 $q$ 的函数。

> 你能否用上面的证明化简拉格朗日动力学方程呢？
>
> 化简后，如何进一步计算得出关节力矩呢？

好了，让我们继续化简拉格朗日动力学方程。
$$
我们把上面证明的T、V代入原方程可以得到：\\
M\ddot{q}=\tau-\frac{\partial V}{\partial q} \\
我们可能这里暂时看不出来[\tau-\frac{\partial V}{\partial q}]是什么物理量，我们姑且将其当作广义力f(q)
$$
这个公式是不是很眼熟，这就是我们广义坐标下的牛顿第二定律。

至此，我们可以写出求关节力矩的步骤与代码。(提示：可以先用matlab求微分，得到结果后再用C++总结出来。)

> 提问：怎么从一个物理学模型求出关节的力矩呢？
>
> 具体步骤是什么？